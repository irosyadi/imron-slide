<html>
 	<head>
 		<title>Circles Sines and Signals - Timbre</title>
	  	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	  	<script type="text/javascript" src="third_party/d3/d3.min.js"></script>

		<script type="text/x-mathjax-config">
			MathJax.Hub.Config({
			  jax: ["input/TeX","input/MathML","output/SVG"],
			  extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js"],
			  TeX: {
			    extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
			  }
			});
		</script>

		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({ TeX: { extensions: ["color.js"] }});
		</script>

		<script type="text/x-mathjax-config">
		    MathJax.Hub.Config(
		    	{
		        	SVG: {linebreaks: { automatic:true }},
		        	displayAlign: "center"
		       	}
		        );
		</script>

		<script type="text/javascript"
		   src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_SVG">
		</script>


		<link href='//fonts.googleapis.com/css?family=Lato:400,700' rel='stylesheet' type='text/css'>
		<link href='//fonts.googleapis.com/css?family=Vollkorn:400italic,400' rel='stylesheet' type='text/css'>

		<style>
			@import url("fontello-b1d57784/css/fontello.css");
			@import url("style.css");
		</style>


 	<link rel="icon" type="" href="favicon.ico"></head>

  <body>

		<div class="littleheader"> TIMBRE
			<div class="subheader" style="font-size: 14px"> HARMONICS, OVERTONES, AND WAVE SHAPES </div>
		</div>

	  	<table class="figureTable">
			<tr>
				<td style="vertical-align: top;">
					<div class="text" style="margin-left: 0px">

				<script>
					var audioCtx = new (window.AudioContext || window.webkitAudioContext)();
					var gainNode = audioCtx.createGain ? audioCtx.createGain() : audioCtx.createGainNode();

					gainNode.gain.value = 0.01;

					var analyser;
					var javascriptNode;

					FFT_SIZE = 1024;
					COLOR = "#333";

					var noiseBufferSize = 2 * audioCtx.sampleRate,
				    noiseBuffer = audioCtx.createBuffer(1, noiseBufferSize, audioCtx.sampleRate),
				    output = noiseBuffer.getChannelData(0);
					for (var i = 0; i < noiseBufferSize; i++) {
					    output[i] = (Math.random() - 0.5) * 2.5;
					}

					javascriptNode = audioCtx.createScriptProcessor(FFT_SIZE, 1, 1);
					javascriptNode.connect(audioCtx.destination);
					analyser = audioCtx.createAnalyser();
					analyser.smoothingTimeConstant = 0.7;
					analyser.minDecibels = -90;
					analyser.maxDecibels = 0;
					analyser.fftSize = FFT_SIZE;
					analyser.connect(javascriptNode);
					analyser.connect(audioCtx.destination);
					gainNode.connect(analyser);

					ANALYSER_DATA = [];
					NEW_DATA_AVAILABLE = false;

					function playWave(type) {

						console.log(type);
						audioCtx.resume();

						currentTime = audioCtx.currentTime;

						if (type == "custom")
						{
							var whiteNoise = audioCtx.createBufferSource();
							whiteNoise.buffer = noiseBuffer;
							whiteNoise.loop = true;
							whiteNoise.connect(gainNode);
							whiteNoise.start(currentTime);
							whiteNoise.stop(currentTime + 2);
						}
						else
						{
							var oscillator = audioCtx.createOscillator();
							oscillator.connect(gainNode);
							oscillator.frequency.value = 440;
							oscillator.type = type;
							oscillator.start(currentTime);
							oscillator.stop(currentTime + 2);
						}

						if (type == 'sine') { COLOR = "steelblue"; }
						if (type == 'square') { COLOR = "red"; }
						if (type == 'sawtooth') { COLOR = "green"; }
						if (type == 'custom') { COLOR = "grey"; }
					}

					javascriptNode.onaudioprocess = function() {
					    var array =  new Uint8Array(analyser.frequencyBinCount);
					    analyser.getByteFrequencyData(array);
					    ANALYSER_DATA = array;
					    NEW_DATA_AVAILABLE = true;
					    //console.log(array.length);
					    //console.log(max);
					}
				</script>

					
					<svg id="spectrum" class="svgWithText" width="700" height="200" style="padding: 5px"></svg>
					<script type="text/javascript" src="js/spectrum.js"></script>
					<table>
							<tr class="figureCaption">
								<td width="25%">
									Sine Wave<br/><br/>
								</td>
								<td width="25%">
									Square Wave<br/><br/>
								</td>
								<td width="25%">
									Saw Wave<br/><br/>
								</td>
								<td width="25%">
									Noise Wave<br/><br/>
								</td>
							</tr>
							<tr>
								<td width="25%">
									<div id="animatedWrapper" class="animation" style="position: relative;">
										<svg id="sineicon" class="svgWithText" width="170" height="100" style="padding: 5px"></svg>
		  								<script type="text/javascript" src="js/icon_sine.js"></script>
	  								</div>
	  							</td>
	  							<td width="25%">
									<div id="animatedWrapper" class="animation" style="position: relative;">
										<svg id="squareicon" class="svgWithText" width="170" height="100" style="padding: 5px"></svg>
		  								<script type="text/javascript" src="js/icon_square.js"></script>
	  								</div>
	  							</td>
	  							<td width="25%">
									<div id="animatedWrapper" class="animation" style="position: relative;">
										<svg id="sawicon" class="svgWithText" width="170" height="100" style="padding: 5px"></svg>
		  								<script type="text/javascript" src="js/icon_saw.js"></script>
	  								</div>
	  							</td>
	  							<td width="25%">
									<div id="animatedWrapper" class="animation" style="position: relative;">
										<svg id="noiseicon" class="svgWithText" width="170" height="100" style="padding: 5px"></svg>
		  								<script type="text/javascript" src="js/icon_noise.js"></script>
	  								</div>
	  							</td>
							</tr>
							<tr class="figureCaption">
								<td width="25%" class="animation">
									<br/>
									<button onClick="playWave('sine');">♫ Play</button>
								</td>
								<td width="25%" class="animation">
									<br/>
									<button onClick="playWave('square');">♫ Play</button>
								</td>
								<td width="25%" class="animation">
									<br/>
									<button onClick="playWave('sawtooth');">♫ Play</button>
								</td>
								<td width="25%" class="animation">
									<br/>
									<button onClick="playWave('custom');">♫ Play</button>
								</td>
							</tr>
	  				</table>
	  				<br/>

	  			</td>
			</tr>
		</table>

  </body>
</html>